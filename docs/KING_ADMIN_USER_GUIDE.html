<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="pandoc">
  <title>King Admin User Guide</title>
  <link rel="stylesheet" href="kingkiosk-docs.css">
  <link rel="icon" href="kingkiosk-icon.svg" type="image/svg+xml">
</head>
<body>

<!-- Top Navigation -->
<nav class="top-nav">
  <a href="index.html" class="logo">
    <img src="kingkiosk-icon.svg" alt="KingKiosk" class="logo-icon">
    <span>KingKiosk Docs</span>
  </a>
  <div class="nav-search-wrap">
    <div class="nav-search" id="navSearch">
      <svg class="nav-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="navSearchInput" class="nav-search-input" placeholder="Search docs..." autocomplete="off" spellcheck="false">
      <kbd class="nav-search-kbd">/</kbd>
    </div>
    <div class="nav-search-results" id="navSearchResults"></div>
  </div>
  <ul class="nav-links">
    <li><a href="index.html" >Home</a></li>
    <li><a href="KINGKIOSK_USER_GUIDE.html" >User Guide</a></li>
    <li><a href="MQTT_WIDGET_REFERENCE.html" >MQTT Reference</a></li>
    <li><a href="CUSTOM_WIDGET_SDK.html" >Widget SDK</a></li>
    <li><a href="https://kingkiosk.kallinnovations.com" target="_blank">Website &nearr;</a></li>
  </ul>
</nav>

<!-- Sidebar Toggle (mobile) -->
<button class="sidebar-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')" aria-label="Toggle navigation">
  &#9776;
</button>

<div class="page-wrapper">

  <!-- Sidebar with TOC -->
  <aside class="sidebar">
    <div class="toc-title">On this page</div>
    <ul>
    <li><a href="#king-admin-user-guide"
    id="toc-king-admin-user-guide"><span
    class="toc-section-number">1</span> King Admin User Guide</a>
    <ul>
    <li><a href="#table-of-contents" id="toc-table-of-contents"><span
    class="toc-section-number">1.1</span> Table of Contents</a></li>
    <li><a href="#logging-in" id="toc-logging-in"><span
    class="toc-section-number">1.2</span> Logging In</a>
    <ul>
    <li><a href="#connection-modes" id="toc-connection-modes"><span
    class="toc-section-number">1.2.1</span> Connection Modes</a></li>
    <li><a href="#desktop-and-mobile-login"
    id="toc-desktop-and-mobile-login"><span
    class="toc-section-number">1.2.2</span> Desktop and Mobile
    Login</a></li>
    <li><a href="#web-login" id="toc-web-login"><span
    class="toc-section-number">1.2.3</span> Web Login</a></li>
    <li><a href="#web-tls-restrictions"
    id="toc-web-tls-restrictions"><span
    class="toc-section-number">1.2.4</span> Web TLS
    Restrictions</a></li>
    <li><a href="#ha-addon-mode" id="toc-ha-addon-mode"><span
    class="toc-section-number">1.2.5</span> HA Addon Mode</a></li>
    <li><a href="#remember-me-and-auto-connect"
    id="toc-remember-me-and-auto-connect"><span
    class="toc-section-number">1.2.6</span> Remember Me and
    Auto-Connect</a></li>
    <li><a href="#command-signing" id="toc-command-signing"><span
    class="toc-section-number">1.2.7</span> Command Signing</a></li>
    <li><a href="#connection-failures-and-reconnect"
    id="toc-connection-failures-and-reconnect"><span
    class="toc-section-number">1.2.8</span> Connection Failures and
    Reconnect</a></li>
    </ul></li>
    <li><a href="#home-dashboard" id="toc-home-dashboard"><span
    class="toc-section-number">1.3</span> Home Dashboard</a>
    <ul>
    <li><a href="#finding-your-devices"
    id="toc-finding-your-devices"><span
    class="toc-section-number">1.3.1</span> Finding Your
    Devices</a></li>
    <li><a href="#device-cards" id="toc-device-cards"><span
    class="toc-section-number">1.3.2</span> Device Cards</a></li>
    <li><a href="#removing-a-device" id="toc-removing-a-device"><span
    class="toc-section-number">1.3.3</span> Removing a Device</a></li>
    <li><a href="#notifications" id="toc-notifications"><span
    class="toc-section-number">1.3.4</span> Notifications</a></li>
    </ul></li>
    <li><a href="#managing-kingkiosk-devices"
    id="toc-managing-kingkiosk-devices"><span
    class="toc-section-number">1.4</span> Managing KingKiosk Devices</a>
    <ul>
    <li><a href="#the-kiosk-detail-screen"
    id="toc-the-kiosk-detail-screen"><span
    class="toc-section-number">1.4.1</span> The Kiosk Detail
    Screen</a></li>
    <li><a href="#everyday-controls-volume-brightness-screensaver"
    id="toc-everyday-controls-volume-brightness-screensaver"><span
    class="toc-section-number">1.4.2</span> Everyday Controls: Volume,
    Brightness, Screensaver</a></li>
    <li><a href="#viewing-your-kiosk-screen-view-and-graph-view"
    id="toc-viewing-your-kiosk-screen-view-and-graph-view"><span
    class="toc-section-number">1.4.3</span> Viewing Your Kiosk: Screen
    View and Graph View</a></li>
    <li><a href="#putting-content-on-screen"
    id="toc-putting-content-on-screen"><span
    class="toc-section-number">1.4.4</span> Putting Content on
    Screen</a></li>
    <li><a href="#editing-whats-already-on-screen"
    id="toc-editing-whats-already-on-screen"><span
    class="toc-section-number">1.4.5</span> Editing What’s Already on
    Screen</a></li>
    <li><a href="#the-widget-builder" id="toc-the-widget-builder"><span
    class="toc-section-number">1.4.6</span> The Widget Builder</a></li>
    <li><a href="#the-command-center" id="toc-the-command-center"><span
    class="toc-section-number">1.4.7</span> The Command Center</a></li>
    <li><a href="#saving-and-restoring-layouts"
    id="toc-saving-and-restoring-layouts"><span
    class="toc-section-number">1.4.8</span> Saving and Restoring
    Layouts</a></li>
    <li><a href="#screenshots" id="toc-screenshots"><span
    class="toc-section-number">1.4.9</span> Screenshots</a></li>
    <li><a href="#remote-device-settings"
    id="toc-remote-device-settings"><span
    class="toc-section-number">1.4.10</span> Remote Device
    Settings</a></li>
    <li><a href="#locking-a-kiosk" id="toc-locking-a-kiosk"><span
    class="toc-section-number">1.4.11</span> Locking a Kiosk</a></li>
    <li><a href="#backing-up-and-restoring-configuration"
    id="toc-backing-up-and-restoring-configuration"><span
    class="toc-section-number">1.4.12</span> Backing Up and Restoring
    Configuration</a></li>
    <li><a href="#sending-raw-mqtt-commands"
    id="toc-sending-raw-mqtt-commands"><span
    class="toc-section-number">1.4.13</span> Sending Raw MQTT
    Commands</a></li>
    </ul></li>
    <li><a href="#managing-cameras" id="toc-managing-cameras"><span
    class="toc-section-number">1.5</span> Managing Cameras</a>
    <ul>
    <li><a href="#adding-a-camera" id="toc-adding-a-camera"><span
    class="toc-section-number">1.5.1</span> Adding a Camera</a></li>
    <li><a href="#the-camera-detail-screen"
    id="toc-the-camera-detail-screen"><span
    class="toc-section-number">1.5.2</span> The Camera Detail
    Screen</a></li>
    <li><a href="#starting-and-stopping-a-camera"
    id="toc-starting-and-stopping-a-camera"><span
    class="toc-section-number">1.5.3</span> Starting and Stopping a
    Camera</a></li>
    <li><a href="#watching-a-live-feed"
    id="toc-watching-a-live-feed"><span
    class="toc-section-number">1.5.4</span> Watching a Live
    Feed</a></li>
    <li><a href="#ai-detection-and-overlays"
    id="toc-ai-detection-and-overlays"><span
    class="toc-section-number">1.5.5</span> AI Detection and
    Overlays</a></li>
    <li><a href="#two-way-audio-talkback"
    id="toc-two-way-audio-talkback"><span
    class="toc-section-number">1.5.6</span> Two-Way Audio
    (Talkback)</a></li>
    <li><a href="#ignore-zones" id="toc-ignore-zones"><span
    class="toc-section-number">1.5.7</span> Ignore Zones</a></li>
    <li><a href="#recordings" id="toc-recordings"><span
    class="toc-section-number">1.5.8</span> Recordings</a></li>
    <li><a href="#rtsp-export" id="toc-rtsp-export"><span
    class="toc-section-number">1.5.9</span> RTSP Export</a></li>
    </ul></li>
    <li><a href="#troubleshooting" id="toc-troubleshooting"><span
    class="toc-section-number">1.6</span> Troubleshooting</a></li>
    </ul></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <div class="content-wrapper">
    <main class="content">
      <header id="title-block-header">
        <h1 class="title">King Admin User Guide</h1>
        <p class="subtitle">Administration and End-User Operations
Guide</p>
        <p class="date">Last updated: February 2026</p>
      </header>
<h1 data-number="1" id="king-admin-user-guide"><span
class="header-section-number">1</span> King Admin User Guide</h1>
<p>King Admin is the admin console for your King ecosystem. It gives you
a visual interface for managing KingKiosk digital signage devices and
RTSP cameras — all built on top of the same MQTT messaging your devices
already use. Think of it as a control room: you can see what every
device is displaying, push new content to screens, monitor camera feeds
with AI overlays, and adjust settings, all from one place.</p>
<p>King Admin runs on macOS, Windows, Linux, iOS, Android, and in any
web browser.</p>
<hr />
<h2 data-number="1.1" id="table-of-contents"><span
class="header-section-number">1.1</span> Table of Contents</h2>
<ul>
<li><a href="#logging-in">Logging In</a>
<ul>
<li><a href="#connection-modes">Connection Modes</a></li>
<li><a href="#desktop-and-mobile-login">Desktop and Mobile
Login</a></li>
<li><a href="#web-login">Web Login</a></li>
<li><a href="#web-tls-restrictions">Web TLS Restrictions</a></li>
<li><a href="#ha-addon-mode">HA Addon Mode</a></li>
<li><a href="#remember-me-and-auto-connect">Remember Me and
Auto-Connect</a></li>
<li><a href="#command-signing">Command Signing</a></li>
<li><a href="#connection-failures-and-reconnect">Connection Failures and
Reconnect</a></li>
</ul></li>
<li><a href="#home-dashboard">Home Dashboard</a>
<ul>
<li><a href="#finding-your-devices">Finding Your Devices</a></li>
<li><a href="#device-cards">Device Cards</a></li>
<li><a href="#removing-a-device">Removing a Device</a></li>
<li><a href="#notifications">Notifications</a></li>
</ul></li>
<li><a href="#managing-kingkiosk-devices">Managing KingKiosk Devices</a>
<ul>
<li><a href="#the-kiosk-detail-screen">The Kiosk Detail Screen</a></li>
<li><a href="#everyday-controls-volume-brightness-screensaver">Everyday
Controls: Volume, Brightness, Screensaver</a></li>
<li><a href="#viewing-your-kiosk-screen-view-and-graph-view">Viewing
Your Kiosk: Screen View and Graph View</a></li>
<li><a href="#putting-content-on-screen">Putting Content on
Screen</a></li>
<li><a href="#editing-whats-already-on-screen">Editing What’s Already on
Screen</a></li>
<li><a href="#the-widget-builder">The Widget Builder</a>
<ul>
<li><a href="#step-1--choose-a-widget-type">Step 1 — Choose a Widget
Type</a></li>
<li><a href="#step-2--configure">Step 2 — Configure</a></li>
<li><a href="#step-3--preview-and-deploy">Step 3 — Preview and
Deploy</a></li>
</ul></li>
<li><a href="#the-command-center">The Command Center</a></li>
<li><a href="#saving-and-restoring-layouts">Saving and Restoring
Layouts</a></li>
<li><a href="#screenshots">Screenshots</a></li>
<li><a href="#remote-device-settings">Remote Device Settings</a></li>
<li><a href="#locking-a-kiosk">Locking a Kiosk</a></li>
<li><a href="#backing-up-and-restoring-configuration">Backing Up and
Restoring Configuration</a></li>
<li><a href="#sending-raw-mqtt-commands">Sending Raw MQTT
Commands</a></li>
</ul></li>
<li><a href="#managing-cameras">Managing Cameras</a>
<ul>
<li><a href="#adding-a-camera">Adding a Camera</a></li>
<li><a href="#the-camera-detail-screen">The Camera Detail
Screen</a></li>
<li><a href="#starting-and-stopping-a-camera">Starting and Stopping a
Camera</a></li>
<li><a href="#watching-a-live-feed">Watching a Live Feed</a></li>
<li><a href="#ai-detection-and-overlays">AI Detection and
Overlays</a></li>
<li><a href="#two-way-audio-talkback">Two-Way Audio (Talkback)</a></li>
<li><a href="#ignore-zones">Ignore Zones</a></li>
<li><a href="#recordings">Recordings</a></li>
<li><a href="#rtsp-export">RTSP Export</a></li>
</ul></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<hr />
<h2 data-number="1.2" id="logging-in"><span
class="header-section-number">1.2</span> Logging In</h2>
<h3 data-number="1.2.1" id="connection-modes"><span
class="header-section-number">1.2.1</span> Connection Modes</h3>
<p>King Admin reaches your devices through MQTT. There are two ways to
connect, and the app tells you which one is active with a toast
notification after login:</p>
<p><strong>Direct MQTT</strong> — The app connects straight to your MQTT
broker. This is what you use on desktop and mobile, and on the web if
you are not running the Home Assistant addon. You fill in the broker
address and credentials on the login screen and hit Connect.</p>
<p><strong>HA Addon Mode</strong> — If King Admin is deployed as a Home
Assistant addon and you open it through Home Assistant’s sidebar, it
detects the King Core 3 backend automatically and connects without
showing a login screen at all. Core 3 maintains the broker connection on
the server side and relays messages to the admin app over HTTP.</p>
<h3 data-number="1.2.2" id="desktop-and-mobile-login"><span
class="header-section-number">1.2.2</span> Desktop and Mobile Login</h3>
<p>When you open King Admin on macOS, Windows, Linux, iOS, or Android,
you see a login screen with the King Admin icon and four fields:</p>
<p><strong>Broker Host / URL</strong> — Type your broker’s IP address or
hostname. For most home setups, this is something like
<code>192.168.1.50</code> or <code>mosquitto.local</code>. You can also
paste a full URI if you need to specify the transport explicitly
(e.g. <code>mqtt://192.168.1.50</code> for TCP, or
<code>ws://192.168.1.50/mqtt</code> for WebSocket), but most people just
type the IP and leave the rest to the defaults.</p>
<p><strong>Port</strong> — Pre-filled with <code>1883</code>, the
standard MQTT port. Change this only if your broker listens on a
different port.</p>
<p><strong>Username and Password</strong> — Fill these in if your broker
requires authentication (most do). Leave them blank if your broker
allows anonymous connections.</p>
<p>Below the credentials, there are a few more options:</p>
<p><strong>Use TLS</strong> — Turn this on if your broker requires an
encrypted connection. When you enable TLS, two more options appear:</p>
<ul>
<li><strong>Allow insecure/self-signed certs</strong> — Check this if
your broker uses a self-signed certificate. The app will accept it
without validation. A warning toast reminds you this is not recommended
for production.</li>
<li><strong>CA Certificate (PEM)</strong> — If your organization runs
its own Certificate Authority, paste the CA’s root certificate here in
PEM format. This lets the app trust your broker’s certificate without
disabling validation entirely. This field only appears when TLS is on
and the insecure-cert option is off.</li>
</ul>
<p><strong>Remember Me</strong> — Check this and the app saves your
credentials securely. Next time you open King Admin, it auto-connects
without showing the login screen.</p>
<p>Press <strong>Connect</strong>. The button shows a spinner while the
connection is being established. If it succeeds, you are taken straight
to the Home Dashboard.</p>
<h3 data-number="1.2.3" id="web-login"><span
class="header-section-number">1.2.3</span> Web Login</h3>
<p>When you run King Admin in a web browser, there is one important
difference: <strong>browsers can only connect to MQTT brokers over
WebSocket</strong>. They cannot open raw TCP connections. The login
screen adapts for this automatically.</p>
<p><strong>What you enter is the same</strong> — broker host, port,
username, password. But behind the scenes the app always uses WebSocket
(<code>ws://</code> or <code>wss://</code>) to reach your broker.</p>
<p><strong>The port default changes based on how you loaded the
page:</strong> - If you loaded King Admin over <strong>HTTPS</strong>,
the port defaults to <code>8884</code> and the app uses
<strong>WSS</strong> (encrypted WebSocket). A green chip below the form
confirms “Secure connection (WSS).” - If you loaded King Admin over
<strong>HTTP</strong>, the port defaults to <code>1884</code> and the
app uses <strong>WS</strong> (unencrypted WebSocket). An orange chip
shows “Unencrypted connection (WS).”</p>
<p>These are the standard WebSocket ports for the Mosquitto addon in
Home Assistant. If your broker uses different WebSocket ports, change
the port field accordingly.</p>
<p><strong>Your broker must have a WebSocket listener enabled.</strong>
This is a separate listener from the normal MQTT TCP port. If you are
using the Home Assistant Mosquitto addon, WebSocket listeners on 1884
and 8884 are usually pre-configured. If you are running your own
Mosquitto, you need a <code>listener 1884</code> with
<code>protocol websockets</code> in your config.</p>
<p>There is no TLS toggle on web — the app automatically matches the
WebSocket security to the page protocol. You cannot override this.</p>
<h3 data-number="1.2.4" id="web-tls-restrictions"><span
class="header-section-number">1.2.4</span> Web TLS Restrictions</h3>
<p>This is the most common source of connection problems on the web, so
it is worth understanding clearly:</p>
<p><strong>If King Admin is served over HTTPS, it must connect to your
broker over WSS (encrypted WebSocket).</strong> Browsers enforce this —
they will not allow an HTTPS page to open an unencrypted WebSocket
connection.</p>
<p><strong>WSS requires your broker’s TLS certificate to be trusted by
the browser.</strong> This means the certificate must be: - Issued by a
public Certificate Authority (like Let’s Encrypt), <strong>or</strong> -
A certificate whose CA is installed in your operating system’s trust
store so the browser recognizes it.</p>
<p><strong>Self-signed certificates will not work on the web.</strong>
Unlike the desktop app where you can check “Allow insecure certs,”
browsers provide no way for a web app to bypass certificate validation.
If your broker uses a self-signed cert, the WSS connection will simply
fail with no useful error message.</p>
<p><strong>Your options if you have a self-signed cert:</strong> -
<strong>Serve King Admin over HTTP instead of HTTPS</strong> so it
connects via plain WS (no certificate validation needed). This is
unencrypted but avoids the cert issue entirely. - <strong>Get a proper
certificate</strong> for your broker from Let’s Encrypt or another CA. -
<strong>Install your private CA’s root certificate</strong> in your OS
trust store so the browser trusts it. - <strong>Use the desktop or
mobile app</strong> instead of the web version — those platforms support
the “Allow insecure certs” toggle.</p>
<h3 data-number="1.2.5" id="ha-addon-mode"><span
class="header-section-number">1.2.5</span> HA Addon Mode</h3>
<p>If you are running King Admin as a Home Assistant addon and open it
through Home Assistant’s sidebar or ingress URL, you do not need to do
anything. The app detects the King Core 3 backend at startup, connects
through its HTTP bridge, and takes you directly to the Home
Dashboard.</p>
<p>If auto-detection fails (for example, if Core 3 is still starting
up), the app falls back to showing the normal login screen so you can
connect directly.</p>
<p>In HA Addon mode, the app polls Core 3 for device updates roughly
every 800ms. It also opens a lightweight direct MQTT connection in the
background for screenshot data, since those payloads are large and
benefit from real-time delivery.</p>
<h3 data-number="1.2.6" id="remember-me-and-auto-connect"><span
class="header-section-number">1.2.6</span> Remember Me and
Auto-Connect</h3>
<p><strong>On desktop and mobile</strong>, the Remember Me checkbox
controls whether your credentials are saved. When checked and the
connection succeeds, the app stores your broker address, port, username,
and password in secure platform storage (Keychain on macOS/iOS, Keystore
on Android, platform-appropriate secure storage on Windows/Linux). On
next launch, the app auto-connects and takes you straight to the
dashboard. If the auto-connect fails (broker unreachable, credentials
changed), you see the login screen with your saved values pre-filled so
you can edit and retry. Disconnecting always clears saved
credentials.</p>
<p><strong>On the web</strong>, credentials are saved automatically
after every successful connection — there is no checkbox. The next time
you open the page, your fields are pre-filled. However, the app does not
auto-connect on web; it first tries HA Addon auto-detection, and if that
fails, shows the login screen with your saved values.</p>
<h3 data-number="1.2.7" id="command-signing"><span
class="header-section-number">1.2.7</span> Command Signing</h3>
<p>If your deployment requires it, you can enable HMAC-SHA256 command
signing so that every command King Admin sends includes a cryptographic
signature. This prevents anyone with broker access from spoofing
commands to your devices.</p>
<p>To enable it: 1. From the Home Dashboard, tap the overflow menu
(three dots in the top-right). 2. Tap <strong>Signing (On/Off)</strong>.
3. Enter the shared secret. This must be the exact same secret
configured on your King devices. 4. Save.</p>
<p>All commands will now include a signed envelope. If your devices are
not configured to verify signatures, they will ignore the signing
fields, so enabling this harmlessly does nothing until both sides are
set up.</p>
<h3 data-number="1.2.8" id="connection-failures-and-reconnect"><span
class="header-section-number">1.2.8</span> Connection Failures and
Reconnect</h3>
<p>If the connection drops while you are using King Admin (broker
restarts, network blip, etc.), the app automatically retries every 5
seconds until it reconnects. You will see the device cards go offline
and come back as the connection restores.</p>
<p>If the initial login fails, an error notification appears. Common
causes:</p>
<ul>
<li><strong>Wrong broker address or port</strong> — double-check the IP
and port number.</li>
<li><strong>Authentication failure</strong> — verify your username and
password match the broker config.</li>
<li><strong>WebSocket listener not enabled</strong> (web only) — your
broker needs a separate WebSocket listener configured.</li>
<li><strong>Certificate not trusted</strong> (web WSS only) — see <a
href="#web-tls-restrictions">Web TLS Restrictions</a>.</li>
<li><strong>Broker unreachable</strong> — check that the broker is
running and your network allows the connection.</li>
</ul>
<hr />
<h2 data-number="1.3" id="home-dashboard"><span
class="header-section-number">1.3</span> Home Dashboard</h2>
<p>Once connected, the Home Dashboard is your starting point. It shows
every device King Admin has discovered — your KingKiosk screens and your
cameras — as a grid of cards.</p>
<h3 data-number="1.3.1" id="finding-your-devices"><span
class="header-section-number">1.3.1</span> Finding Your Devices</h3>
<p>Devices appear automatically as they publish status messages over
MQTT. Cameras (which are managed via REST API rather than MQTT) also
appear here. If you just connected and the grid is empty, give it a
moment — devices populate as their retained messages arrive.</p>
<p><strong>Search</strong> — Tap the magnifying glass icon in the top
bar to reveal a search field. Type part of a device name or ID to filter
the grid in real time.</p>
<p><strong>Filter by status</strong> — A row of chips below the top bar
lets you show All devices, only Online (green), or only Offline (red).
This is useful when you have a large fleet and want to quickly spot
problems.</p>
<p><strong>Filter by type</strong> — Next to the status chips are type
filters: All Types, Kiosk, and Camera. Use these to focus on one
category of device.</p>
<p><strong>Sort</strong> — Tap the sort icon to choose how the grid is
ordered: alphabetically, by last-seen time, online-first, or grouped by
device type.</p>
<p><strong>Switch views</strong> — Toggle between a visual <strong>Grid
View</strong> (square cards with screenshots and status) and a compact
<strong>List View</strong> (rows with name, type, status, and
timestamps). Your preference is saved between sessions.</p>
<p><strong>Pull to refresh</strong> — Drag down on the device list to
force a refresh.</p>
<h3 data-number="1.3.2" id="device-cards"><span
class="header-section-number">1.3.2</span> Device Cards</h3>
<p>Each card gives you a quick snapshot of a device’s state:</p>
<p><strong>KingKiosk cards</strong> show the latest screenshot from the
device as the card background, with the device name and an
online/offline indicator overlaid. You can see at a glance what the
screen is currently displaying.</p>
<p><strong>Camera cards</strong> show a snapshot from the camera with
badges indicating which AI features are active (AI detection, face
recognition, speech transcription, recording) and the camera’s state
(Running, Stopped, Error).</p>
<p>Tap any card to open its full detail screen.</p>
<h3 data-number="1.3.3" id="removing-a-device"><span
class="header-section-number">1.3.3</span> Removing a Device</h3>
<p>Each card has a small close button. Tapping it shows a confirmation
dialog explaining what will happen: - For KingKiosk devices, this clears
the device from the broker by publishing empty retained messages. The
device itself is not affected — it will reappear if it publishes again.
- For cameras, this stops the camera and permanently deletes its
configuration from Core 3.</p>
<h3 data-number="1.3.4" id="notifications"><span
class="header-section-number">1.3.4</span> Notifications</h3>
<p>A notification panel sits at the bottom of every screen once you are
logged in. It tracks connection events, command results, errors, and
status changes.</p>
<p>When collapsed, it shows a bell icon with an unread count and a
preview of the latest message. Tap it to expand into a scrollable list
of all notifications, color-coded by type (blue for info, green for
success, amber for warnings, red for errors). You can dismiss individual
notifications or tap “Clear All” to reset.</p>
<hr />
<h2 data-number="1.4" id="managing-kingkiosk-devices"><span
class="header-section-number">1.4</span> Managing KingKiosk Devices</h2>
<p>KingKiosk devices are digital signage screens. They can display web
pages, videos, images, live streams, data widgets, and alert
notifications — all controlled remotely through King Admin.</p>
<h3 data-number="1.4.1" id="the-kiosk-detail-screen"><span
class="header-section-number">1.4.1</span> The Kiosk Detail Screen</h3>
<p>Tap a KingKiosk card on the Home Dashboard to open its detail screen.
This is where you spend most of your time managing a kiosk. The screen
is organized from top to bottom:</p>
<p><strong>Top bar</strong> — Shows the device name, an animated
online/offline badge, and live telemetry chips for battery level, CPU
usage, and memory when the device reports them. If a command is
in-flight, an amber chip appears showing what is pending and how long it
has been waiting.</p>
<p><strong>Action chips</strong> — A horizontally scrollable row of
shortcut buttons: Command Center, Widget Builder, Export Config, Import
Config, Raw Command, Screenshot Viewer, and Take Screenshot. These are
quick access points for the features described below.</p>
<p><strong>Quick controls</strong> — A translucent bar with the most
commonly used controls: volume slider, brightness slider, and action
chips for Close All, window tiling mode, screenshot, and screensaver
toggle.</p>
<p><strong>Main view</strong> — A visual representation of what is on
the kiosk screen, with two view modes (Screen View and Graph View)
described below.</p>
<p><strong>Editor panel</strong> — When you select an element, a panel
slides in from the right showing all of its editable properties.</p>
<h3 data-number="1.4.2"
id="everyday-controls-volume-brightness-screensaver"><span
class="header-section-number">1.4.2</span> Everyday Controls: Volume,
Brightness, Screensaver</h3>
<p>These are the things you will adjust most often, so they are right at
the top of the detail screen in the quick controls bar:</p>
<p><strong>Adjusting volume</strong> — Drag the volume slider left or
right. It snaps to 5% increments. When you release it, the new volume is
sent to the device immediately.</p>
<p><strong>Adjusting brightness</strong> — Same as volume. Drag the
brightness slider and it updates the device on release.</p>
<p><strong>Activating or dismissing the screensaver</strong> — The
screensaver chip shows “Screensaver” when the screen is awake and “Wake
Screen” when the screensaver is active. Tap it to toggle. After
toggling, the app waits two seconds and then requests a fresh screenshot
so you can see the result.</p>
<p><strong>Closing everything on screen</strong> — Tap “Close All” to
immediately remove every window, media element, widget, and alert from
the kiosk display. This is useful when you want to start fresh.</p>
<p><strong>Switching window mode</strong> — Tap “Tile Windows” to
arrange all windows in an automatic grid layout, or “Float Windows” to
let them be positioned freely. The label changes to reflect the current
mode.</p>
<h3 data-number="1.4.3"
id="viewing-your-kiosk-screen-view-and-graph-view"><span
class="header-section-number">1.4.3</span> Viewing Your Kiosk: Screen
View and Graph View</h3>
<p>The main area of the detail screen shows you what is on the kiosk.
There are two ways to look at it, toggled via the segmented button in
the toolbar:</p>
<p><strong>Screen View</strong> is a proportionally-scaled replica of
the kiosk display. The latest screenshot is shown as the background, and
every element (window, video, widget, alert) is drawn on top at its real
position and size, color-coded by category: blue for windows, green for
media, orange for widgets, red for alerts. You can <strong>drag elements
to reposition them</strong> and <strong>drag corner handles to resize
them</strong> — changes are sent to the device as you move things
around.</p>
<p><strong>Graph View</strong> shows a node graph with the display at
center and elements arranged around it, connected by curved lines. This
is useful when elements overlap on screen and you need to see them
individually. Drag nodes to rearrange the layout. Use the zoom controls
or Ctrl/Cmd+scroll to zoom in and out.</p>
<p>The toolbar above the view shows live counters for how many media,
windows, widgets, and alerts are currently on screen, plus buttons to
add new elements, open remote settings, and lock/unlock the device.</p>
<h3 data-number="1.4.4" id="putting-content-on-screen"><span
class="header-section-number">1.4.4</span> Putting Content on
Screen</h3>
<p>There are several ways to add content to a kiosk, depending on what
you need:</p>
<p><strong>Quick add from the toolbar</strong> — Click the “Add Element”
button in the view toolbar. A dialog appears with a grid of element
types organized by category: - <strong>Windows</strong>: Browser,
WebView, PDF viewer - <strong>Media</strong>: Video, Audio, Image,
Carousel, YouTube, RTSP stream - <strong>Widgets</strong>: Clock,
Calendar, Timer, Weather, Gauge, Chart - <strong>Alerts</strong>: Info,
Success, Warning, Error</p>
<p>Pick a type, give it a title, enter a URL (for web pages, videos,
images, or streams), and click Add. The element appears on the kiosk
immediately.</p>
<p><strong>Example — Putting a website on screen:</strong> 1. Click “Add
Element” in the toolbar. 2. Choose “Browser” under the Windows category.
3. Enter a title like “Dashboard” and the URL
(e.g. <code>https://grafana.local/d/my-dashboard</code>). 4. Click Add.
5. The browser window appears on the kiosk. Select it in the view and
drag it to position, or use the editor panel to set exact
coordinates.</p>
<p><strong>Example — Playing a video:</strong> 1. Click “Add Element”
and choose “Video” under Media. 2. Enter the video URL (a direct link to
an MP4, HLS stream, or similar). 3. Click Add. 4. Select the video
element and use the editor panel to enable looping, adjust volume, or
switch to fullscreen display mode.</p>
<p><strong>Example — Sending an alert:</strong> 1. Click “Add Element”
and choose an alert type (Info, Warning, etc.). 2. Type your message as
the title. 3. Click Add. The alert appears on the kiosk screen.</p>
<p>For more complex or precise content creation, use the <strong>Widget
Builder</strong> or the <strong>Command Center</strong> (described
below).</p>
<h3 data-number="1.4.5" id="editing-whats-already-on-screen"><span
class="header-section-number">1.4.5</span> Editing What’s Already on
Screen</h3>
<p>Click on any element in the Screen View or Graph View to select it.
The <strong>editor panel</strong> slides in from the right side of the
screen with everything you can change:</p>
<p><strong>Common fields</strong> (all element types): Title, URL,
position (X and Y coordinates), size (Width and Height), opacity slider
(fully transparent to fully opaque), and z-index (controls stacking
order — higher numbers are on top).</p>
<p><strong>Media-specific controls</strong> (videos, audio, carousels):
- Play and Pause buttons. - Toggle switches for Loop, Autoplay, and
Muted. - Volume slider. - For carousels: interval between slides,
transition effect (fade/slide/scale), scroll direction, and navigation
buttons. - For RTSP and WebRTC streams: stream URL field and hardware
acceleration toggle.</p>
<p><strong>Window-specific controls</strong> (browsers, webviews): -
Show/hide title bar. - Allow dragging and resizing by kiosk users. -
Zoom level (50% to 200%). - For remote browsers: server URL, video
quality profile, connect/disconnect.</p>
<p><strong>Widget-specific controls</strong> — Each widget type has its
own settings. For example: - Gauges: the MQTT topic to bind to, min/max
range, unit label, and interactive toggle. - Weather: location, forecast
toggle, temperature units. - Clock: digital or analog style, 24-hour
format, show seconds.</p>
<p>After making changes, click <strong>Apply Changes</strong> in the
footer. The button highlights when you have unsaved changes so you do
not forget. You can also <strong>delete</strong> the element from the
panel footer, or use quick actions like Bring to Front, Maximize, or
Close.</p>
<h3 data-number="1.4.6" id="the-widget-builder"><span
class="header-section-number">1.4.6</span> The Widget Builder</h3>
<p>The Widget Builder is a 3-step wizard for creating widgets visually,
with live preview on actual kiosk hardware. It is the most powerful way
to build data-driven displays — gauges, charts, buttons, weather panels,
clocks, and more — because you can see exactly what the widget will look
like on the real screen while you configure it.</p>
<p>Open it from the <strong>Widget Builder</strong> chip in the action
bar on any kiosk detail screen. It opens as a full-screen dark interface
with frosted-glass panels and a step indicator at the top.</p>
<p>You can also navigate between steps at any time by clicking the step
chips in the header (“1 Type”, “2 Configure”, “3 Preview &amp; Deploy”),
or press <strong>Escape</strong> to go back a step.</p>
<h4 data-number="1.4.6.1" id="step-1-choose-a-widget-type"><span
class="header-section-number">1.4.6.1</span> Step 1 — Choose a Widget
Type</h4>
<p>You see a responsive grid of widget type cards, each with a title,
description, and icon. Tap the one you want and the builder advances to
Step 2 automatically.</p>
<p>The types are organized into four categories:</p>
<p><strong>Data-Driven</strong> — These widgets bind to MQTT topics (or
Home Assistant entities) and display live data. When you select one of
these, the Entity Picker appears in Step 2 to help you connect it to a
data source.</p>
<ul>
<li><strong>Gauge</strong> — Displays a live numeric value with a
radial, linear, circular, semicircular, or thermostat-style gauge.
Supports color zones, thresholds, and multiple pointers.</li>
<li><strong>Chart</strong> — Line, bar, or pie chart fed by MQTT
data.</li>
<li><strong>MQTT Button</strong> — A toggle or momentary button that
publishes to an MQTT topic when tapped and shows live state from a
subscription.</li>
<li><strong>Alarmo</strong> — A Home Assistant Alarmo security panel
with arm/disarm modes and PIN entry.</li>
<li><strong>MQTT Image</strong> — Displays images received via MQTT
payloads (useful for camera frames or generated images).</li>
</ul>
<p><strong>Display</strong> — These widgets show information that does
not require an MQTT data binding.</p>
<ul>
<li><strong>Clock</strong> — Analog or digital, with options for 24-hour
format, seconds hand, and theme.</li>
<li><strong>Weather</strong> — Current conditions and forecast using a
weather API. Configure location, units, and refresh interval.</li>
<li><strong>Animated Text</strong> — Text with animation effects (fade,
typewriter, wave, kinetic presets).</li>
<li><strong>Screensaver</strong> — Configures the kiosk’s idle
screensaver with custom items and timing.</li>
</ul>
<p><strong>Interactive</strong> — Widgets that users at the kiosk (or
you, remotely) can interact with.</p>
<ul>
<li><strong>Map</strong> — Interactive map with configurable tile
provider, initial position, and zoom.</li>
<li><strong>Canvas</strong> — Drawing and diagramming surface with
objects, grid snap, and touch interaction.</li>
<li><strong>Remote Browser</strong> — A browser session streamed via
WebRTC from a Feature Server.</li>
<li><strong>Local Browser</strong> — A native web view.</li>
</ul>
<p><strong>Media</strong> — Content playback widgets.</p>
<ul>
<li><strong>Media</strong> — Video, audio, image, or web content with
playback controls.</li>
<li><strong>Carousel</strong> — A rotating slideshow of multiple
items.</li>
<li><strong>DLNA Player</strong> — A UPnP/DLNA media renderer.</li>
</ul>
<h4 data-number="1.4.6.2" id="step-2-configure"><span
class="header-section-number">1.4.6.2</span> Step 2 — Configure</h4>
<p>Once you pick a type, the configuration form appears. It has up to
three sections, depending on the widget type.</p>
<h5 data-number="1.4.6.2.1"
id="the-entity-picker-data-driven-widgets-only"><span
class="header-section-number">1.4.6.2.1</span> The Entity Picker
(Data-Driven widgets only)</h5>
<p>If you chose a data-driven type (Gauge, Chart, Button, Alarmo, or
MQTT Image) and your kiosks are connected to Home Assistant, an
<strong>Entity Picker</strong> appears at the top of the form. This is
the fastest way to wire up a widget to real data.</p>
<p><strong>How it works:</strong></p>
<ol type="1">
<li><p>A <strong>Domain Filter</strong> bar shows chips for each
available entity domain — sensor, light, switch, climate, camera,
alarm_control_panel, and so on. Tap a domain to narrow the list, or
leave it on “All” to see everything.</p></li>
<li><p>Below that, a <strong>search field</strong> lets you filter by
entity name, ID, or area. Results are grouped by room/area, with each
area header showing its name and entity count.</p></li>
<li><p>Each entity in the list shows its friendly name, entity ID,
current state, and unit of measurement. Tap one to select it.</p></li>
</ol>
<p><strong>What happens when you select an entity</strong> — this is
where the builder saves you real time. It auto-populates the widget’s
configuration based on the entity:</p>
<ul>
<li>The <strong>MQTT subscribe topic</strong> is set to the entity’s
state topic
(e.g. <code>kingkiosk/ha/state/sensor/living_room_temperature</code>).</li>
<li>The <strong>MQTT publish topic</strong> is set to the entity’s
command topic.</li>
<li>The <strong>title and label</strong> are set to the entity’s
friendly name.</li>
<li>The <strong>unit</strong> is filled from the entity’s unit of
measurement.</li>
<li>For numeric entities (sensors, thermostats): the <strong>min and
max</strong> values are intelligently guessed — it uses the entity’s own
min/max attributes if available, or infers reasonable ranges from the
unit (0–100 for percentages, 50–90 for Fahrenheit temperatures, 10–35
for Celsius, etc.).</li>
<li>For <strong>climate entities</strong> specifically, the builder
creates a full thermostat gauge configuration with three pointers
(current temperature, heat setpoint, cool setpoint), each with the
correct color and publish payloads for controlling the thermostat.</li>
<li>For <strong>buttons</strong>, it sets up toggle mode with the
correct service call payload.</li>
<li>For <strong>Alarmo</strong>, it pre-fills the entity and MQTT base
topic.</li>
</ul>
<p>You can always override any of these auto-populated values in the
form below. The entity picker is a starting point, not a locked-in
choice.</p>
<h5 data-number="1.4.6.2.2" id="the-configuration-form"><span
class="header-section-number">1.4.6.2.2</span> The Configuration
Form</h5>
<p>Below the entity picker (or at the top, for non-data-driven types),
the form shows fields specific to the widget type you selected. Here are
the key options for the most commonly used types:</p>
<p><strong>Gauge configuration:</strong> - <strong>Gauge Type</strong> —
Choose from Linear, Radial, Circular, Semicircular, or Thermostat.
Thermostat mode is designed for HVAC displays with multiple pointers. -
<strong>Min and Max</strong> — The range of the gauge. - <strong>Default
Value and Unit</strong> — Starting value and the unit label (e.g. “F”,
“%”, “kW”). - <strong>Color Mode</strong> — How the gauge is colored:
Zones (colored bands at value ranges), Thresholds (color changes at
specific values), Gradient (smooth color transition), or Solid (single
color). - <strong>Interactive and Locked</strong> — Whether kiosk users
can drag the gauge to set a value, or whether it is display-only. -
<strong>MQTT Binding</strong> — Subscribe topic (where the gauge reads
values from), publish topic (where it sends values when interacted
with), and JSON field (which field in the MQTT payload contains the
value, e.g. <code>state</code> or <code>data.value</code>). -
<strong>Pointers</strong> — You can add multiple pointers to a single
gauge. Each pointer has its own label, style (Needle, Dot, Target, or
Bar), color, data binding, and publish payload. For thermostat gauges, a
“Thermostat Preset” button auto-creates the standard Current/Heat/Cool
pointer set. - <strong>Thresholds and Zones</strong> — Defined as JSON
arrays for fine control over color breakpoints.</p>
<p><strong>Weather configuration:</strong> - <strong>API Key</strong> —
Your weather service API key. - <strong>Location</strong> — City and
country code (e.g. “San Francisco,US”). - <strong>Units</strong> —
Imperial, Metric, or Standard. - <strong>Show Forecast</strong> — Toggle
the multi-day forecast display. - <strong>Auto Refresh</strong> —
Whether to periodically refresh, and how often (in seconds).</p>
<p><strong>MQTT Button configuration:</strong> - <strong>Mode</strong> —
Toggle (stays on/off), Button (momentary), or Icon Button. -
<strong>Label</strong> — Text shown on the button. - <strong>Publish
Topic and Payload</strong> — The MQTT message sent when the button is
pressed. - <strong>Subscribe Topic and Status Path</strong> — Where to
read the current state from. - <strong>Icons and Colors</strong> —
Separate icons and colors for the on and off states.</p>
<p><strong>Clock configuration:</strong> - <strong>Mode</strong> —
Analog or Digital. - <strong>Theme</strong> — Auto, Light, or Dark. -
<strong>Show Numbers</strong> — Whether the clock face shows hour
numbers. - <strong>Show Second Hand</strong> — Whether seconds are
displayed.</p>
<p><strong>Chart, Map, Canvas, Carousel, and other types</strong> each
have their own form with relevant fields. The forms are designed to
expose the most common options as simple fields, with an “Advanced” JSON
editor available for power users who need access to every possible
parameter.</p>
<h5 data-number="1.4.6.2.3" id="window-geometry"><span
class="header-section-number">1.4.6.2.3</span> Window Geometry</h5>
<p>At the bottom of every configuration form, regardless of widget type,
is the <strong>Window Geometry</strong> section. This controls where the
widget appears on the kiosk screen:</p>
<ul>
<li><strong>Window ID</strong> — Auto-generated, but you can change
it.</li>
<li><strong>Title</strong> — The window title (shown in the title bar if
the kiosk displays one).</li>
<li><strong>X and Y</strong> — Position in pixels from the top-left
corner.</li>
<li><strong>Width and Height</strong> — Size in pixels.</li>
<li><strong>Opacity</strong> — 0 (fully transparent) to 1 (fully
opaque).</li>
</ul>
<h5 data-number="1.4.6.2.4" id="validation"><span
class="header-section-number">1.4.6.2.4</span> Validation</h5>
<p>If any required fields are missing or invalid, a red
<strong>Validation Errors</strong> panel appears below the geometry
section listing each problem. These must be resolved before
deploying.</p>
<p>From here, click <strong>Preview &amp; Deploy</strong> to advance to
Step 3, or <strong>Back</strong> to return to the type picker.</p>
<h4 data-number="1.4.6.3" id="step-3-preview-and-deploy"><span
class="header-section-number">1.4.6.3</span> Step 3 — Preview and
Deploy</h4>
<p>This step has two panels side by side on wide screens (stacked on
narrow screens): the <strong>Live Preview</strong> panel on the left and
the <strong>Deploy</strong> panel on the right.</p>
<h5 data-number="1.4.6.3.1" id="live-preview"><span
class="header-section-number">1.4.6.3.1</span> Live Preview</h5>
<p>This is the feature that makes the Widget Builder special. Instead of
guessing what your widget will look like, you push it to a real kiosk
and see it live.</p>
<p><strong>To start a live preview:</strong></p>
<ol type="1">
<li><p>Choose a <strong>preview device</strong> from the dropdown. This
lists all online KingKiosk and KingLauncher devices. The preview device
can be different from your eventual deploy target — you might preview on
a test kiosk and deploy to production.</p></li>
<li><p>Click <strong>Start Preview</strong>. A pulsing green dot appears
to confirm the preview is active.</p></li>
</ol>
<p><strong>What happens on the kiosk:</strong> The builder first saves a
backup of the kiosk’s current screen layout (so nothing is lost). It
then overlays a dark semi-transparent backdrop and renders your widget
on top of it, so you can see it clearly against a clean background.</p>
<p><strong>Live updating:</strong> As you go back to Step 2 and change
configuration values, the widget on the kiosk updates automatically
after a short 500ms pause. You can watch the real hardware while you
adjust colors, sizes, data bindings, gauge ranges, and positions. This
tight feedback loop means you can fine-tune a widget in seconds rather
than going through a deploy-check-redeploy cycle.</p>
<p><strong>Stopping preview:</strong> Click <strong>Stop
Preview</strong> (or navigate away from the Widget Builder). The kiosk’s
original screen layout is automatically restored from the backup. Even
if you close the browser tab or the app crashes, the next time you
connect King Admin will attempt to clean up.</p>
<p>You can switch the preview device at any time — the old device is
restored and the new device picks up the preview.</p>
<h5 data-number="1.4.6.3.2" id="the-json-editor"><span
class="header-section-number">1.4.6.3.2</span> The JSON Editor</h5>
<p>Next to (or below) the preview panel, a <strong>JSON editor</strong>
shows the live MQTT command that will be sent to the kiosk. This is the
raw payload — the exact JSON that creates the widget.</p>
<p>The editor syncs bidirectionally with the form: - Change a field in
the form → the JSON updates instantly. - Edit the JSON directly → the
form fields update to match.</p>
<p>This is useful for power users who want to hand-tune parameters that
are not exposed in the form, or for copying a command payload to use
elsewhere. A <strong>Copy</strong> button copies the JSON to your
clipboard.</p>
<p>If you paste or type invalid JSON, an error message appears below the
editor. The builder preserves any custom fields in the JSON that it does
not recognize, so you can add extra keys without losing them when
switching back to the form.</p>
<h5 data-number="1.4.6.3.3" id="templates"><span
class="header-section-number">1.4.6.3.3</span> Templates</h5>
<p>Templates let you save and reuse widget configurations:</p>
<ul>
<li><strong>Save Template</strong> — Click the bookmark icon, give the
template a name (e.g. “Lobby Temperature Gauge”), and save. The entire
widget type and configuration are stored.</li>
<li><strong>Load Template</strong> — Click the bookmarks icon to open a
list of all saved templates. Tap one to restore its widget type and
configuration. You can also delete templates from this list.</li>
</ul>
<p>Templates are saved locally, so they persist across sessions. They
are a good way to standardize widgets across a fleet — configure one
gauge perfectly, save it as a template, and deploy it to every
kiosk.</p>
<h5 data-number="1.4.6.3.4" id="deploying"><span
class="header-section-number">1.4.6.3.4</span> Deploying</h5>
<p>Choose how and where to deploy:</p>
<ul>
<li><strong>Single device</strong> — Select a target device from the
dropdown and click <strong>Deploy Widget</strong>. The widget is created
on that kiosk immediately. A success notification confirms the
deployment.</li>
<li><strong>Batch deploy</strong> — Toggle <strong>“Deploy to all online
devices”</strong> and click <strong>Batch Deploy</strong>. The widget
command is sent to every online KingKiosk and KingLauncher device. A
notification tells you how many devices received it.</li>
</ul>
<p>If there are validation errors in your configuration, deploying is
blocked and you see a warning listing the problems.</p>
<p><strong>Keyboard shortcut:</strong> Press <strong>Ctrl+Enter</strong>
on Step 3 to deploy immediately.</p>
<p>If you had a live preview running on the same device you are
deploying to, the builder is smart about it: it stops the preview
(removing the backdrop), deploys the widget cleanly, and restores the
rest of the screen layout. The result is your widget appearing on the
kiosk exactly as it looked in preview, but now as a permanent part of
the display.</p>
<h4 data-number="1.4.6.4"
id="widget-builder-walkthrough-temperature-gauge-from-a-ha-sensor"><span
class="header-section-number">1.4.6.4</span> Widget Builder Walkthrough:
Temperature Gauge from a HA Sensor</h4>
<p>Here is a complete example of using the Widget Builder end to
end:</p>
<ol type="1">
<li>From a kiosk detail screen, tap <strong>Widget Builder</strong> in
the action chip bar.</li>
<li>In Step 1, tap <strong>Gauge</strong> in the Data-Driven
category.</li>
<li>In Step 2, the Entity Picker appears at the top. Tap the
<strong>“sensor”</strong> domain filter chip to narrow the list to
sensors only. Use the search field to find your temperature sensor
(e.g. type “living room”). Tap it.</li>
<li>The builder auto-fills the MQTT topics, sets the unit to “F” (or
“C”), and guesses a reasonable min/max range based on the sensor’s
current value.</li>
<li>Under Gauge Settings, change the <strong>Gauge Type</strong> to
“Radial” and set the <strong>Color Mode</strong> to “Zones.” Under the
Advanced section, add color zones: green for comfortable (65–75F), amber
for warm (75–85F), red for hot (85+).</li>
<li>Under Window Geometry, set the position and size where you want the
gauge on screen (e.g. X: 50, Y: 50, Width: 300, Height: 300).</li>
<li>Click <strong>Preview &amp; Deploy</strong> to go to Step 3.</li>
<li>Select your kiosk from the preview device dropdown and click
<strong>Start Preview</strong>. The gauge appears on the actual kiosk
screen with the dark backdrop behind it.</li>
<li>Go back to Step 2 (click “2 Configure” in the header or press
Escape). Adjust the colors and size. Watch the kiosk update live after
each change.</li>
<li>When it looks right, go back to Step 3. Click <strong>Save
Template</strong> and name it “Room Temperature Gauge” for future
reuse.</li>
<li>Select the target kiosk (or toggle batch deploy) and click
<strong>Deploy Widget</strong>. The gauge is now live on the kiosk,
reading real-time temperature data.</li>
</ol>
<h4 data-number="1.4.6.5"
id="widget-builder-walkthrough-deploying-a-clock-to-every-screen"><span
class="header-section-number">1.4.6.5</span> Widget Builder Walkthrough:
Deploying a Clock to Every Screen</h4>
<ol type="1">
<li>Open the Widget Builder from any kiosk.</li>
<li>Tap <strong>Clock</strong> in the Display category.</li>
<li>Set <strong>Mode</strong> to “Digital”, enable <strong>24-Hour
Format</strong>, and turn on <strong>Show Seconds</strong>.</li>
<li>Set the window position to the top-right corner of the screen
(e.g. X: 1520, Y: 20, Width: 380, Height: 100).</li>
<li>Preview on one device to confirm it looks right.</li>
<li>On Step 3, toggle <strong>“Deploy to all online
devices”</strong>.</li>
<li>Click <strong>Batch Deploy</strong>. Every online kiosk gets the
same clock widget in the same position.</li>
</ol>
<h4 data-number="1.4.6.6"
id="widget-builder-walkthrough-thermostat-control-from-ha-climate-entity"><span
class="header-section-number">1.4.6.6</span> Widget Builder Walkthrough:
Thermostat Control from HA Climate Entity</h4>
<ol type="1">
<li>Open the Widget Builder and tap <strong>Gauge</strong>.</li>
<li>In the Entity Picker, filter by <strong>“climate”</strong> and
select your thermostat entity.</li>
<li>The builder automatically configures a thermostat-style gauge with
three pointers: a white needle for current temperature, an orange dot
for the heat setpoint, and a blue dot for the cool setpoint. The publish
payloads are pre-configured so dragging the setpoint pointers on the
kiosk actually controls the thermostat.</li>
<li>Preview it, adjust the size, and deploy.</li>
</ol>
<h3 data-number="1.4.7" id="the-command-center"><span
class="header-section-number">1.4.7</span> The Command Center</h3>
<p>The Command Center is an advanced control panel with 10 tabs covering
every aspect of kiosk management. Open it from the action chip bar or
the overflow menu. It is a 900x700 dialog organized by category:</p>
<p><strong>System</strong> — Brightness and volume sliders with Set,
Get, and Restore buttons. Take screenshots with or without confirmation.
Request the device configuration or view command history. Use this when
you need precise numeric control rather than the quick controls bar.</p>
<p><strong>Windows</strong> — Manage individual windows. Switch between
floating and tiling mode. Select a specific window from a dropdown list,
then set its exact position, size, and opacity, or close, maximize, or
bring it to front. The “Close All Windows” button clears everything at
once.</p>
<p><strong>Media</strong> — Create and control media elements. Set a
URL, pick a type (video, audio, image), configure looping and autoplay,
and play or pause existing media.</p>
<p><strong>Widgets</strong> — Create widgets using forms for each type:
gauges, charts, weather displays, clocks, calendars, alarmo panels, MQTT
buttons, DLNA players, and more. Each form has the fields specific to
that widget type.</p>
<p><strong>States</strong> — Save the current screen layout as a named
state, load a previously saved state, list all saved states, or export a
state as JSON for backup. This is how you switch between different
display configurations — for example, a “Lobby Welcome” layout during
business hours and a “After Hours” layout at night.</p>
<p><strong>Schedule</strong> — Set up commands to run at specific
times.</p>
<p><strong>Batch</strong> — Send multiple commands as a single batch
operation. Useful for complex layout changes that involve creating
several elements at once.</p>
<p><strong>AI/Vision</strong> — Configure person detection and security
camera features on kiosks that support them.</p>
<p><strong>Alerts</strong> — Send alert notifications to the kiosk:
info, success, warning, or error messages with customizable position,
auto-dismiss timing, and sound.</p>
<p><strong>Cache</strong> — Manage the kiosk’s content cache.</p>
<h3 data-number="1.4.8" id="saving-and-restoring-layouts"><span
class="header-section-number">1.4.8</span> Saving and Restoring
Layouts</h3>
<p>Screen states let you save the entire arrangement of a kiosk — every
element’s position, size, configuration, and content — and restore it
later. This is useful for:</p>
<ul>
<li>Switching between daytime and evening content.</li>
<li>Setting up event-specific displays and reverting afterward.</li>
<li>Keeping a known-good layout as a backup before making changes.</li>
</ul>
<p>To save the current layout, open the Command Center, go to the
<strong>States</strong> tab, type a name, and click Save. To restore it
later, select it from the list and click Load. You can also export
states as JSON to transfer between devices.</p>
<h3 data-number="1.4.9" id="screenshots"><span
class="header-section-number">1.4.9</span> Screenshots</h3>
<p>King Admin automatically requests a screenshot when you open a kiosk
detail screen (if the device is online). The screenshot serves as the
background in Screen View, so you can see what the actual display looks
like.</p>
<p>To manually capture a fresh screenshot, tap “Take Screenshot” in the
action chip bar or the quick controls bar. A toast confirms the request
was sent.</p>
<p>To view screenshots in detail, tap “Screenshot Viewer” in the action
chip bar. This opens a dialog with the full-resolution image, zoom
controls (0.2x to 5x), metadata (timestamp, size), and a button to copy
the raw image data to clipboard.</p>
<h3 data-number="1.4.10" id="remote-device-settings"><span
class="header-section-number">1.4.10</span> Remote Device Settings</h3>
<p>The Remote Settings screen lets you configure the kiosk device itself
— not just what is on screen, but how the device behaves. Open it from
the gear icon in the graph view toolbar.</p>
<p>Settings are organized into sections that vary by device platform.
Common sections include: - <strong>Security</strong> — PIN and lock
configuration. - <strong>App Settings</strong> — General application
behavior. - <strong>MQTT Settings</strong> — The device’s broker
connection parameters. - <strong>Feature Server</strong> — Integration
with phone/server features. - <strong>Speech &amp; AI</strong> — Voice
assistant and AI configuration. - <strong>Media &amp; Cameras</strong> —
Media playback and camera settings. - <strong>Networked Audio</strong> —
Audio networking options.</p>
<p>Each section can be edited through structured form fields or as raw
JSON for power users. A dirty-state indicator warns you about unsaved
changes before you navigate away.</p>
<h3 data-number="1.4.11" id="locking-a-kiosk"><span
class="header-section-number">1.4.11</span> Locking a Kiosk</h3>
<p>To prevent users at the kiosk from interacting with the touchscreen,
use the lock feature:</p>
<ol type="1">
<li>Tap the <strong>Lock</strong> button in the view toolbar.</li>
<li>Enter a PIN code.</li>
<li>The device locks — touch interaction is disabled.</li>
</ol>
<p>To unlock, tap the button again and enter the same PIN. The lock
state is reflected in the toolbar with an animated icon.</p>
<h3 data-number="1.4.12"
id="backing-up-and-restoring-configuration"><span
class="header-section-number">1.4.12</span> Backing Up and Restoring
Configuration</h3>
<p><strong>Export Config</strong> — Tap “Export Config” in the action
chip bar. The app retrieves the device’s full configuration and displays
it as formatted JSON. Copy it to your clipboard or save it externally as
a backup.</p>
<p><strong>Import Config</strong> — Tap “Import Config” to open a JSON
editor. Paste a previously exported configuration (or one you have
hand-crafted) and click Apply. The app sends it to the device as a
provisioning command. This is useful for cloning settings between
devices or restoring a device to a known state.</p>
<h3 data-number="1.4.13" id="sending-raw-mqtt-commands"><span
class="header-section-number">1.4.13</span> Sending Raw MQTT
Commands</h3>
<p>For advanced users, the Raw Command dialog lets you send arbitrary
JSON payloads directly to the device over MQTT. Open it from the action
chip bar.</p>
<p>The dialog includes: - A <strong>scope toggle</strong> — System
(sends to the device’s system command topic) or Element (sends to a
specific element’s command topic, with a field for the element ID). - A
<strong>template picker</strong> — A dropdown with dozens of pre-built
command templates covering every documented MQTT command. Select a
template and the JSON editor fills in with a ready-to-use payload that
you can customize. - A <strong>JSON editor</strong> with syntax
highlighting and validation. - A <strong>topic preview</strong> showing
exactly where the command will be published. - A <strong>Send
button</strong> to publish.</p>
<p>This is the escape hatch for anything that does not yet have a
dedicated button in the GUI. The template picker makes it accessible
even if you are not familiar with the raw MQTT command format.</p>
<hr />
<h2 data-number="1.5" id="managing-cameras"><span
class="header-section-number">1.5</span> Managing Cameras</h2>
<p>Cameras in King Admin are RTSP surveillance cameras managed through
the King Core 3 REST API. They support live viewing, AI-powered object
detection, face recognition, audio event detection, speech
transcription, recording, and RTSP re-export.</p>
<h3 data-number="1.5.1" id="adding-a-camera"><span
class="header-section-number">1.5.1</span> Adding a Camera</h3>
<p>From the Home Dashboard, tap the floating action button (camera icon)
in the bottom-right corner. This opens a 3-step wizard:</p>
<p><strong>Step 1 — Connection.</strong> Enter a name for the camera
(e.g. “Front Door” or “Parking Lot”), the RTSP URL
(e.g. <code>rtsp://192.168.1.100:554/stream1</code>), and optionally a
username and password if the camera requires authentication.</p>
<p><strong>Step 2 — Test.</strong> The wizard shows the URL you entered
and a “Test Connection” button. Click it to verify the stream is
reachable. If successful, you see the stream’s resolution, codec, and
FPS displayed as info chips. If it fails, you see the error message with
options to retry or go back and edit the URL.</p>
<p><strong>Step 3 — Features.</strong> Toggle the capabilities you want:
- <strong>Auto-start</strong> (on by default) — The camera starts
automatically when Core 3 boots. - <strong>Object Detection</strong> (on
by default) — YOLO-based detection that draws bounding boxes around
people, vehicles, animals, and other objects. - <strong>Face
Recognition</strong> — Identifies known faces. Requires object detection
to be enabled. - <strong>Audio Transcription</strong> — Whisper
speech-to-text from the camera’s audio feed. - <strong>Audio Event
Detection</strong> — Detects environmental sounds like barking, sirens,
glass breaking, and alarms. - <strong>Recording</strong> — Records video
to MP4 files on the server. You can optionally specify a custom
recording path. - <strong>RTSP Export</strong> — Re-exports the camera
stream as a standard RTSP URL that other systems (NVRs, VLC, etc.) can
consume. Optional rotation (0, 90, 180, or 270 degrees).</p>
<p>A summary at the bottom shows your camera name, URL, and which
features are enabled. Click “Create Camera” to finish. The camera
appears on the Home Dashboard.</p>
<h3 data-number="1.5.2" id="the-camera-detail-screen"><span
class="header-section-number">1.5.2</span> The Camera Detail Screen</h3>
<p>Tap a camera card to open its detail screen. The layout is a single
scrollable column, centered and capped at 800px wide:</p>
<p>At the top, the <strong>app bar</strong> shows the camera name and a
colored state badge: green “Running,” red “Stopped,” amber “Starting” or
“Reconnecting,” or red “Error.”</p>
<p>Below that, the <strong>live preview</strong> area takes up most of
the screen — a 16:9 viewport showing either a periodically-refreshing
snapshot or a live WebRTC stream (see below). Active feature badges
appear in the top-left corner (AI, Face, STT, Audio, REC, RTSP).
Detection overlays are drawn directly on top of the preview.</p>
<p>Below the preview, a <strong>controls bar</strong> contains the
Start/Stop button and a row of feature toggle buttons for Detection,
Faces, STT, Audio Detection, Recording, and RTSP Export. Each button is
color-coded and shows whether the feature is currently active.</p>
<p>Further down, expandable panels show detailed information for each
feature: detection results with class names and confidence scores,
recognized faces, audio event history, transcription output, recording
files, and RTSP export status.</p>
<h3 data-number="1.5.3" id="starting-and-stopping-a-camera"><span
class="header-section-number">1.5.3</span> Starting and Stopping a
Camera</h3>
<p>Tap the <strong>Start</strong> button (green) to begin capturing from
the RTSP stream. The button shows a spinner during startup. Once
running, it changes to a red <strong>Stop</strong> button. Stopping the
camera disconnects from the RTSP stream and halts all AI processing.</p>
<h3 data-number="1.5.4" id="watching-a-live-feed"><span
class="header-section-number">1.5.4</span> Watching a Live Feed</h3>
<p>The preview area supports two modes, toggled via a badge in the
top-right corner of the preview:</p>
<p><strong>Snapshot mode</strong> (default) — A JPEG snapshot refreshes
every 3 seconds. This uses minimal bandwidth and works well for casual
monitoring.</p>
<p><strong>WebRTC mode</strong> — A real-time video stream with minimal
latency. Switch to this when you need to see what is happening right
now. WebRTC also enables audio playback (with a mute/unmute toggle) and
two-way audio if the camera supports it.</p>
<h3 data-number="1.5.5" id="ai-detection-and-overlays"><span
class="header-section-number">1.5.5</span> AI Detection and
Overlays</h3>
<p>When object detection is enabled on a running camera, you see
bounding boxes drawn over the live preview in real time:</p>
<ul>
<li>Each detected object has a colored box (red for people, cyan for
vehicles, violet for animals, green for furniture, etc.), a label
showing the object class, and a confidence percentage.</li>
<li>The Object Detection panel (expandable below the controls) shows a
scrollable list of current detections with precise coordinates.</li>
</ul>
<p>When face recognition is also enabled: - Recognized faces show a
green bounding box with the person’s name and recognition confidence. -
Unknown faces show a confidence-colored box. - The Face Recognition
panel lists all detected faces with their recognition status.</p>
<p>Audio event detection, when enabled, listens for environmental sounds
and displays recent events (e.g. “bark 94%,” “siren 87%”) in the Audio
Events panel.</p>
<p>Audio transcription runs Whisper speech-to-text on the camera’s audio
feed, with status shown in the Transcription panel.</p>
<h3 data-number="1.5.6" id="two-way-audio-talkback"><span
class="header-section-number">1.5.6</span> Two-Way Audio (Talkback)</h3>
<p>When viewing a camera in WebRTC mode that supports two-way audio, a
microphone button appears in the top-right of the preview. Tap it to
start push-to-talk — the button turns green and your microphone audio is
sent to the camera’s speaker. Tap again to stop. This is useful for
intercom-style communication through a doorbell or entry camera.</p>
<h3 data-number="1.5.7" id="ignore-zones"><span
class="header-section-number">1.5.7</span> Ignore Zones</h3>
<p>If there are areas of the camera frame that produce unwanted
detections (a busy street visible through a window, a TV screen, a clock
with moving hands), you can define ignore zones to suppress detections
in those areas:</p>
<ol type="1">
<li>Expand the <strong>Ignore Bounds</strong> panel below the
preview.</li>
<li>Click <strong>Add ignore area</strong>. An orange rectangle appears
on the preview.</li>
<li><strong>Drag</strong> the rectangle to cover the area you want to
exclude.</li>
<li><strong>Drag the corner handle</strong> to resize it.</li>
<li>Detections that fall within the orange zone are filtered out.</li>
</ol>
<p>You can add multiple ignore zones and delete them individually from
the panel.</p>
<h3 data-number="1.5.8" id="recordings"><span
class="header-section-number">1.5.8</span> Recordings</h3>
<p>When recording is enabled, the camera saves video as MP4 files on the
Core 3 server. The Recording panel shows: - Whether recording is
currently active or idle. - A list of saved recordings with filename,
duration, and file size. - Per-recording actions:
<strong>Download</strong> the file, <strong>Copy URL</strong> to
clipboard, or <strong>Delete</strong> the recording (disabled for the
actively-recording file).</p>
<p>The recording list refreshes automatically.</p>
<h3 data-number="1.5.9" id="rtsp-export"><span
class="header-section-number">1.5.9</span> RTSP Export</h3>
<p>When RTSP export is enabled, the camera stream is re-published as a
standard RTSP URL through go2rtc. The RTSP Export panel shows the export
URL. You can copy this URL and paste it into any RTSP-compatible viewer,
NVR, or media player to watch the stream outside of King Admin.</p>
<p>Optional rotation (set during camera creation or edited later)
rotates the exported stream by 90, 180, or 270 degrees.</p>
<hr />
<h2 data-number="1.6" id="troubleshooting"><span
class="header-section-number">1.6</span> Troubleshooting</h2>
<p><strong>Devices are not appearing on the Home Dashboard</strong> -
Confirm your MQTT connection is established (the toast after login
should say “Direct Mode” or “HA Addon Mode”). - Kiosk devices appear
when they publish their status topics. If a device was powered off when
you connected, it will appear when it comes online. - For cameras,
verify that King Core 3’s camera API is reachable. - Try pulling down on
the device grid to force a refresh.</p>
<p><strong>A device shows as offline even though it is running</strong>
- King Admin uses a 45-second heartbeat timeout. If a device stops
sending messages for that long, it is marked offline. - Stale retained
messages with old timestamps are filtered out automatically. The device
must send fresh messages to be marked online. - Check your MQTT broker
logs for disconnect/reconnect events.</p>
<p><strong>Cannot connect from the web browser</strong> - Your MQTT
broker must have a <strong>WebSocket listener</strong> enabled. The
standard MQTT TCP port (1883) does not accept WebSocket connections. -
If the page is served over HTTPS, the broker must be reachable over
<strong>WSS</strong> with a valid, browser-trusted TLS certificate.
Self-signed certs will silently fail. - Check the browser’s developer
console (F12 → Console tab) for WebSocket connection errors.</p>
<p><strong>HA Addon mode does not activate</strong> - Verify King Core 3
is installed, running, and healthy. - Check the Core 3 addon logs in
Home Assistant for errors. - If the Core 3 probe fails, the app falls
back to showing the direct login screen — you can still connect
manually.</p>
<p><strong>Commands are not reaching a device</strong> - If command
signing is enabled, make sure the shared secret matches on both King
Admin and the device. Try disabling signing temporarily to rule it out.
- Check your MQTT broker’s access control lists (ACLs) to make sure
publish permissions are granted for the admin user.</p>
<p><strong>Screenshots are not updating</strong> - The device must be
online and responsive. Check the online/offline badge. - Try clicking
“Take Screenshot” manually. - On very slow networks, screenshots (which
are base64-encoded images) can take a moment to arrive.</p>
      <footer class="doc-footer">
        <p>
          <a href="https://kingkiosk.kallinnovations.com">KingKiosk</a>
          &mdash; The Programmable Display Runtime &mdash;
          &copy; Kall Innovations
        </p>
      </footer>
    </main>
  </div>

</div>

<!-- Back to Top -->
<button class="back-to-top" onclick="window.scrollTo({top:0,behavior:'smooth'})" aria-label="Back to top">
  &uarr;
</button>

<script>
// Back to Top visibility
const btn = document.querySelector('.back-to-top');
window.addEventListener('scroll', () => {
  btn.classList.toggle('visible', window.scrollY > 400);
});

// Active TOC highlight on scroll
const tocLinks = document.querySelectorAll('#TOC a');
const headings = [];
tocLinks.forEach(link => {
  const id = link.getAttribute('href');
  if (id && id.startsWith('#')) {
    const el = document.getElementById(id.slice(1));
    if (el) headings.push({ el, link });
  }
});

function updateActiveTOC() {
  let current = null;
  const scrollY = window.scrollY + 100;
  for (const { el, link } of headings) {
    if (el.offsetTop <= scrollY) {
      current = link;
    }
  }
  tocLinks.forEach(l => l.classList.remove('active'));
  if (current) current.classList.add('active');
}

window.addEventListener('scroll', updateActiveTOC, { passive: true });
updateActiveTOC();

// Close sidebar on mobile when clicking a link
document.querySelectorAll('.sidebar a').forEach(a => {
  a.addEventListener('click', () => {
    if (window.innerWidth <= 960) {
      document.querySelector('.sidebar').classList.remove('open');
    }
  });
});

// === Doc Nav Search ===
(function initNavSearch() {
  const input = document.getElementById('navSearchInput');
  const resultsEl = document.getElementById('navSearchResults');
  const kbdEl = document.querySelector('.nav-search-kbd');
  if (!input || !resultsEl) return;

  // Build search index from page headings + cross-doc links
  const index = [];

  // Current page headings (h2, h3, h4)
  const currentPage = location.pathname.split('/').pop() || 'index.html';
  const pageNames = {
    'index.html': 'Home',
    'KINGKIOSK_USER_GUIDE.html': 'User Guide',
    'MQTT_WIDGET_REFERENCE.html': 'MQTT Reference',
    'CUSTOM_WIDGET_SDK.html': 'Widget SDK'
  };
  const currentPageName = pageNames[currentPage] || 'Docs';

  document.querySelectorAll('h2, h3, h4').forEach(h => {
    if (!h.id) return;
    const num = h.querySelector('.header-section-number');
    const text = h.textContent.replace(/^\d+[\.\d]*\s*/, '').trim();
    if (!text) return;
    index.push({
      title: text,
      doc: currentPageName,
      url: '#' + h.id,
      isLocal: true
    });
  });

  // Cross-doc pages (always available)
  const docs = [
    { title: 'User Guide', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html', isLocal: false },
    { title: 'MQTT Widget Reference', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html', isLocal: false },
    { title: 'Custom Widget SDK', doc: 'Widget SDK', url: 'CUSTOM_WIDGET_SDK.html', isLocal: false },
    { title: 'Documentation Home', doc: 'Home', url: 'index.html', isLocal: false }
  ];
  // Add cross-doc entries (skip current page)
  docs.forEach(d => {
    if (d.url !== currentPage) index.push(d);
  });

  // Common cross-doc topics for quick access
  const crossTopics = [
    { title: 'Getting Started', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'add_window', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'remove_window', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'arrange_windows', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Carousel', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Gauge Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Chart Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'WebView', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Media Player', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Intercom', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Camera Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Clock Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Weather Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Canvas Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Animated Text', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'LED Panel', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'YouTube Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Calendar Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Map Widget', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Kiosk Mode', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Home Assistant', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Screen Presets', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Scheduling', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'MQTT Connection', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Topic Structure', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Command Envelope', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'window.KingKiosk API', doc: 'Widget SDK', url: 'CUSTOM_WIDGET_SDK.html' },
    { title: 'onCommand()', doc: 'Widget SDK', url: 'CUSTOM_WIDGET_SDK.html' },
    { title: 'sendCommand()', doc: 'Widget SDK', url: 'CUSTOM_WIDGET_SDK.html' },
    { title: 'publishTelemetry()', doc: 'Widget SDK', url: 'CUSTOM_WIDGET_SDK.html' },
    { title: 'TTS / Text-to-Speech', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Screenshot', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Notification', doc: 'MQTT Reference', url: 'MQTT_WIDGET_REFERENCE.html' },
    { title: 'Apple TV / tvOS', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Android Setup', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'iOS Setup', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Windows Setup', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'macOS Setup', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
    { title: 'Linux Setup', doc: 'User Guide', url: 'KINGKIOSK_USER_GUIDE.html' },
  ];
  crossTopics.forEach(t => {
    if (t.url !== currentPage) {
      index.push({ title: t.title, doc: t.doc, url: t.url, isLocal: false });
    }
  });

  let activeIdx = -1;
  let filtered = [];
  let isOpen = false;

  function search(query) {
    const words = query.toLowerCase().trim().split(/\s+/).filter(Boolean);
    if (!words.length) return [];
    const scored = [];
    const seen = new Set();
    for (const item of index) {
      const hay = item.title.toLowerCase();
      let match = true;
      let score = 0;
      for (const w of words) {
        if (!hay.includes(w)) { match = false; break; }
        if (hay.startsWith(w)) score += 10;
        score += 5;
      }
      if (!match) continue;
      // Boost local (same-page) results
      if (item.isLocal) score += 3;
      const key = item.title + '|' + item.url;
      if (seen.has(key)) continue;
      seen.add(key);
      scored.push({ item, score });
    }
    scored.sort((a, b) => b.score - a.score);
    return scored.slice(0, 15).map(s => s.item);
  }

  function highlight(text, query) {
    const words = query.toLowerCase().trim().split(/\s+/).filter(Boolean);
    let result = text;
    for (const w of words) {
      const escaped = w.replace(/[.*+?^{}()|[\]\\]/g, '\\' + String.fromCharCode(36) + '&');
      const re = new RegExp('(' + escaped + ')', 'gi');
      result = result.replace(re, '<mark>' + String.fromCharCode(36) + '1</mark>');
    }
    return result;
  }

  function render(items, query) {
    if (!items.length) {
      resultsEl.innerHTML = '<div class="nav-search-empty">No results found</div>';
      resultsEl.classList.add('open');
      isOpen = true;
      return;
    }
    // Group: This Page vs Other Docs
    const local = items.filter(i => i.isLocal);
    const other = items.filter(i => !i.isLocal);
    let html = '';
    if (local.length) {
      html += '<div class="nav-search-group"><div class="nav-search-group-label">This Page</div>';
      local.forEach(item => {
        const idx = filtered.indexOf(item);
        html += '<a href="' + item.url + '" class="nav-search-item' + (idx === activeIdx ? ' active' : '') + '" data-idx="' + idx + '">'
          + '<div class="nav-search-item-title">' + highlight(item.title, query) + '</div>'
          + '</a>';
      });
      html += '</div>';
    }
    if (other.length) {
      html += '<div class="nav-search-group"><div class="nav-search-group-label">Other Docs</div>';
      other.forEach(item => {
        const idx = filtered.indexOf(item);
        html += '<a href="' + item.url + '" class="nav-search-item' + (idx === activeIdx ? ' active' : '') + '" data-idx="' + idx + '">'
          + '<div class="nav-search-item-title">' + highlight(item.title, query) + '</div>'
          + '<div class="nav-search-item-doc">' + item.doc + '</div>'
          + '</a>';
      });
      html += '</div>';
    }
    resultsEl.innerHTML = html;
    resultsEl.classList.add('open');
    isOpen = true;
  }

  function close() {
    resultsEl.classList.remove('open');
    resultsEl.innerHTML = '';
    isOpen = false;
    activeIdx = -1;
  }

  function updateActive() {
    resultsEl.querySelectorAll('.nav-search-item').forEach(el => {
      el.classList.toggle('active', parseInt(el.dataset.idx) === activeIdx);
    });
    const act = resultsEl.querySelector('.nav-search-item.active');
    if (act) act.scrollIntoView({ block: 'nearest' });
  }

  input.addEventListener('input', () => {
    const q = input.value.trim();
    if (!q) { close(); return; }
    filtered = search(q);
    activeIdx = -1;
    render(filtered, q);
  });

  input.addEventListener('keydown', (e) => {
    if (!isOpen) return;
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      activeIdx = Math.min(activeIdx + 1, filtered.length - 1);
      updateActive();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      activeIdx = Math.max(activeIdx - 1, -1);
      updateActive();
    } else if (e.key === 'Enter' && activeIdx >= 0 && filtered[activeIdx]) {
      e.preventDefault();
      const entry = filtered[activeIdx];
      if (entry.isLocal) {
        const el = document.getElementById(entry.url.slice(1));
        if (el) el.scrollIntoView({ behavior: 'smooth' });
      } else {
        window.location.href = entry.url;
      }
      close();
      input.blur();
    } else if (e.key === 'Escape') {
      close();
      input.blur();
    }
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.nav-search-wrap')) close();
  });

  // "/" keyboard shortcut
  document.addEventListener('keydown', (e) => {
    if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
      const tag = document.activeElement?.tagName;
      if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
      e.preventDefault();
      input.focus();
    }
  });

  input.addEventListener('focus', () => { if (kbdEl) kbdEl.style.opacity = '0'; });
  input.addEventListener('blur', () => { if (kbdEl && !input.value) kbdEl.style.opacity = '1'; });
})();
</script>

</body>
</html>
